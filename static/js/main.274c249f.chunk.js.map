{"version":3,"sources":["ProtoConvert.js","LocalStorage.js","view/MessageBuilder.js","view/ProtoLibrary.js","view/Main.js","index.js"],"names":["require","List","Map","protobuf","shortid","objectFromEntries","entries","o","i","length","_entries$i","Object","G_devel_Javascript_protool_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","k","v","converters","binary","messageToBinary","messageFromBinary","binary-hex","messageDescriptor","message","binaryMessage","Array","from","map","b","toString","join","toUpperCase","hexMessage","binaryMessageArray","push","parseInt","substring","Uint8Array","binary-b64","util","base64","encode","base64Message","window","atob","json","protoMessage","messageToProto","JSON","stringify","jsonMessage","parse","asUTF8","messageFromProtoMessage","json-camel","camelCaseMessage","replaceFieldNames","toObject","toJSONOptions","fieldName","camelCase","jsonCamelCaseMessage","reverseReplaceFieldNames","camelCaseFieldName","json-id","pbJsonMessage","fields","id","jsonIdsMessage","idsMessage","fieldId","converterFormats","keys","sort","converterName","format","converterExtension","convertTo","finish","replacementFunc","_ref","_ref2","newName","fieldDescriptor","resolvedType","constructor","Type","repeated","value","messageObject","messageToProtoInternal","fromObject","mapEntries","_ref3","_ref4","key","valueEntries","fieldsById","name","valueEntry","valueToProto","keyType","get","type","toArray","size","valueEntriesToProto","fieldType","console","error","Enum","convertFrom","encodedMessage","decode","data","TextDecoder","convertedMessage","convertFunc","convertedKey","findConvertedKey","options","_ref5","_ref6","_ref7","_ref8","generate","valueFromProto","values","valueEntriesFromProto","protoValue","defaultValueEntryForField","valueObject","defaultValueForFieldType","valuesById","first","fullMessageDescriptorName","parent","fromJS","isKeyed","reviver","slicedToArray","test","tryParseToInt","toMap","toList","loadJson","keyName","localStorage","getItem","log","saveJson","isEmpty","removeItem","setItem","toJSON","LocalStorage","load","save","rawStoredProtos","messages","config","ProtoConvert","MessageBuilderScaffold","handleSelectMessage","_this","props","callbacks","onSet","undefined","this","path","react_default","a","createElement","Fragment","className","MessageBuilder_StoreMessageButton","MessageBuilder_StoredMessageSelector","storedMessages","shouldSet","onSelectMessage","MessageBuilder_MessageFieldsBuilder","MessageBuilder_Output","builtMessage","buildMessageUpToDate","React","Component","StoredMessageSelector","_this2","event","target","getIn","onChange","keySeq","Output","handleExportToFile","_this3","onExport","handleChangeFormat","onSetFormat","handleFileChange","file","files","reader","FileReader","onload","fileData","result","onImport","onerror","err","readAsArrayBuffer","handleImportFromFile","refs","fileuploader","click","handleChangeBuiltMessage","split","defaultValue","onClick","ref","hidden","errorMessage","renderControls","disabled","StoreMessageButton","_this4","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","handleStartStoring","setState","isStoring","handleCommitStore","storeName","onStore","handleDiscardStore","state","MessageFieldsBuilder","isRegularField","partOf","fieldTypeName","required","_this6","regularFieldDescriptors","filter","oneOfDescriptors","oneofs","regularFieldItems","MessageBuilder_MessageFieldValuesBuilder","concat","oneOfItems","oneOfDescriptor","MessageBuilder_MessageOneOfFieldValuesBuilder","MessageFieldValuesBuilder","_this7","messageFieldValueBuilders","index","MessageBuilder_MessageFieldValueBuilder","numEntries","MessageBuilder_MessageFieldValuesAddControls","numValueEntries","MessageFieldValuesAddControls","handleSet","_this8","onAdd","showSet","showAdd","MessageFieldValueBuilder","handleDelete","_this9","onDelete","handleDuplicate","set","handleMoveUp","onMove","handleMoveDown","showDelete","showDuplicate","showMove","enableMoveDown","enableMoveUp","MessageBuilder_MessageFieldInput","MessageOneOfFieldValuesBuilder","currentFieldDescriptor","maybeCurrentFieldId","_this10","find","newFieldId","newFieldDescriptor","maybeCurrentFieldDescriptor","fieldsArray","MessageFieldInput","MessageBuilder_MessageTextInput","MessageBuilder_MessageBytesInput","MessageBuilder_MessageIntInput","MessageBuilder_MessageFloatInput","MessageBuilder_MessageBoolInput","MessageBuilder_MessageEnumInput","MessageTextInput","handleChange","_this11","MessageBytesInput","isValid","_this12","MessageIntInput","_this13","MessageFloatInput","_this14","MessageBoolInput","_this15","checked","MessageEnumInput","_this16","_this17","ProtoLibrary","ProtoLibrary_ProtoRoot","protoRoot","ProtoLibrary_ProtoFiles","filenames","fileDependencies","ProtoLibrary_ProtoInput","ProtoLibrary_ProtoUpload","ProtoRoot","ProtoLibrary_ProtoNamespace","namespace","ProtoNamespace","handleBuild","onSelectMessageDescriptor","nested","namespaces","Namespace","types","baseName","_namespaces$","subNamespaceName","subNamespace","_types$","subMessageName","subMessage","ProtoLibrary_ProtoMessage","buildable","ProtoMessage","ProtoLibrary_StoredMessages","ProtoFiles","filename","ProtoLibrary_ProtoFile","ProtoFile","handleClick","onRemoveProto","fileDependents","importingFiles","StoredMessages","_this5","ProtoLibrary_StoredMessage","StoredMessage","handleRemove","onRemoveStoredMessage","ProtoInput","handleStartAdding","isAdding","handleSubmit","fileName","protoContent","protoText","onAddProto","ProtoUpload","text","readAsText","FileSaver","loadStoredProtos","isNode","fs","readFileSync","storedProto","Error","Root","loadSync","toJS","keepCase","flatMap","imports","importName","groupBy","importNameAndFilenames","toSet","resolveAll","Main","isNightModeEnabled","handleToggleNightMode","handleAddProto","setIn","contents","_loadStoredProtos","handleRemoveProto","delete","_loadStoredProtos2","handleSelectMessageDescriptor","messageBuildTimer","handleSetFormat","handleExportMessage","kind","extension","blob","Blob","saveAs","handleImportMessage","handleAddToMessage","updateIn","arguments","scheduleBuildMessage","handleDeleteFromMessage","listPath","pop","listKey","last","messagePath","deleteIn","handleSetInMessage","handleMoveInMessage","fromIndex","toIndex","list","movedEntry","insert","handleStoreMessage","rawStoredMessages","handleRemoveStoredMessage","prevTimeout","clearTimeout","setTimeout","libraryCallbacks","messageBuilderCallbacks","_loadStoredProtos3","prevProps","prevState","view_ProtoLibrary","class","MessageBuilder","ReactDOM","render","view_Main","document","getElementById"],"mappings":"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","file":"static/js/main.274c249f.chunk.js","sourcesContent":["const { List, Map } = require('immutable');\r\nconst protobuf = require(\"protobufjs\");\r\nconst shortid = require('shortid');\r\n\r\nfunction objectFromEntries(entries) {\r\n  var o = {};\r\n  for (var i = 0; i < entries.length; ++i) {\r\n    const [k, v] = entries[i];\r\n    o[k] = v\r\n  }\r\n  return o;\r\n}\r\n\r\nconst converters = {\r\n  'binary': ['Binary', 'pbdata', messageToBinary, messageFromBinary],\r\n  'binary-hex': ['Binary (hex)', 'pbdata.hex', messageToBinaryHex, messageFromBinaryHex],\r\n  'binary-b64': ['Binary (base64)', 'pbdata.b64', messageToBinaryBase64, messageFromBinaryBase64],\r\n  'json': ['Json', 'json', messageToJson, messageFromJson],\r\n  'json-camel': ['Json (camelCase)', 'cc.json', messageToJsonCamelCase, messageFromJsonCamelCase],\r\n  'json-id': ['Json (field-IDs)', 'ids.json', messageToJsonIds, messageFromJsonIds],\r\n};\r\n\r\nconst converterFormats = Object.keys(converters).sort();\r\n\r\nfunction converterName(format) {\r\n  return converters[format][0];\r\n}\r\n\r\nfunction converterExtension(format) {\r\n  return converters[format][1];\r\n}\r\n\r\nfunction convertTo(format, messageDescriptor, message) {\r\n  return converters[format][2](messageDescriptor, message);\r\n}\r\n\r\nfunction messageToBinary(messageDescriptor, message) {\r\n  const protoMessage = messageToProto(messageDescriptor, message);\r\n  return messageDescriptor.encode(protoMessage).finish();\r\n}\r\n\r\nfunction messageToBinaryHex(messageDescriptor, message) {\r\n  const binaryMessage = messageToBinary(messageDescriptor, message);\r\n  const hex = Array.from(binaryMessage).map((b) =>\r\n    ((b < 0x10) ? '0' : '') + b.toString(16)\r\n  );\r\n  return hex.join('').toUpperCase();\r\n}\r\n\r\nfunction messageToBinaryBase64(messageDescriptor, message) {\r\n  const binaryMessage = messageToBinary(messageDescriptor, message);\r\n  return protobuf.util.base64.encode(binaryMessage, 0, binaryMessage.length);\r\n}\r\n\r\nfunction messageToJson(messageDescriptor, message) {\r\n  const protoMessage = messageToProto(messageDescriptor, message);\r\n  return JSON.stringify(protoMessage);\r\n}\r\n\r\nfunction messageToJsonCamelCase(messageDescriptor, message) {\r\n  const protoMessage = messageToProto(messageDescriptor, message);\r\n  const camelCaseMessage = replaceFieldNames(\r\n    messageDescriptor,\r\n    messageDescriptor.toObject(protoMessage, protobuf.util.toJSONOptions),\r\n    (fieldName) => protobuf.util.camelCase(fieldName)\r\n  );\r\n  return JSON.stringify(camelCaseMessage);\r\n}\r\n\r\nfunction messageToJsonIds(messageDescriptor, message) {\r\n  const protoMessage = messageToProto(messageDescriptor, message);\r\n  const pbJsonMessage = replaceFieldNames(\r\n    messageDescriptor,\r\n    messageDescriptor.toObject(protoMessage, protobuf.util.toJSONOptions),\r\n    (fieldName, messageDescriptor) => messageDescriptor.fields[fieldName].id);\r\n  return JSON.stringify(pbJsonMessage);\r\n}\r\n\r\nfunction replaceFieldNames(messageDescriptor, protoMessage, replacementFunc) {\r\n  return objectFromEntries(Object.entries(protoMessage).map(([k, v]) => {\r\n    const newName = replacementFunc(k, messageDescriptor);\r\n    const fieldDescriptor = messageDescriptor.fields[k] || messageDescriptor.fields[newName];\r\n\r\n    if (fieldDescriptor.resolvedType && fieldDescriptor.resolvedType.constructor === protobuf.Type) {\r\n      if (fieldDescriptor.repeated) {\r\n        return [\r\n          newName,\r\n          v.map((value) => replaceFieldNames(fieldDescriptor.resolvedType, value, replacementFunc))\r\n        ];\r\n      } else {\r\n        return [newName, replaceFieldNames(fieldDescriptor.resolvedType, v, replacementFunc)];\r\n      }\r\n    } else {\r\n      return [newName, v];\r\n    }\r\n  }));\r\n}\r\n\r\nfunction messageToProto(messageDescriptor, message) {\r\n  const messageObject = messageToProtoInternal(messageDescriptor, message);\r\n  return messageDescriptor.fromObject(messageObject);\r\n}\r\n\r\nfunction messageToProtoInternal(messageDescriptor, message) {\r\n  return message.mapEntries(([key, valueEntries]) => {\r\n    const fieldDescriptor = messageDescriptor.fieldsById[key];\r\n    return [fieldDescriptor.name, valueEntriesToProto(fieldDescriptor, valueEntries)];\r\n  }).toObject();\r\n}\r\n\r\nfunction valueEntriesToProto(fieldDescriptor, valueEntries) {\r\n  if (fieldDescriptor.map) {\r\n    return objectFromEntries(valueEntries.map(valueEntry => [\r\n      valueToProto(fieldDescriptor.keyType, null, valueEntry.get('key')),\r\n      valueToProto(fieldDescriptor.type, fieldDescriptor.resolvedType, valueEntry.get('value')),\r\n    ]).toArray());\r\n  } else if (fieldDescriptor.repeated) {\r\n    return valueEntries.map(valueEntry =>\r\n      valueToProto(fieldDescriptor.type, fieldDescriptor.resolvedType, valueEntry.get('value'))\r\n    ).toArray();\r\n  } else if (valueEntries.size === 1) {\r\n    return valueToProto(fieldDescriptor.type, fieldDescriptor.resolvedType, valueEntries.get(0).get('value'));\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction valueToProto(fieldType, resolvedType, value) {\r\n  switch (fieldType) {\r\n    case \"string\":\r\n    case \"bytes\":\r\n    case \"int32\":\r\n    case \"int64\":\r\n    case \"sint32\":\r\n    case \"sint64\":\r\n    case \"uint32\":\r\n    case \"uint64\":\r\n    case \"fixed32\":\r\n    case \"fixed64\":\r\n    case \"float\":\r\n    case \"double\":\r\n    case \"bool\":\r\n      return value;\r\n    default:\r\n      break;\r\n  }\r\n  if (resolvedType === null) {\r\n    console.error(\"Unhandled value type\", fieldType);\r\n    return \"\";\r\n  }\r\n  if (resolvedType.constructor === protobuf.Enum) {\r\n    return value;\r\n  } else if (resolvedType.constructor === protobuf.Type) {\r\n    return messageToProtoInternal(resolvedType, value);\r\n  }\r\n  console.error(\"Unhandled value type\", fieldType);\r\n  return \"\";\r\n}\r\n\r\nfunction convertFrom(format, messageDescriptor, encodedMessage) {\r\n  return converters[format][3](messageDescriptor, encodedMessage);\r\n}\r\n\r\nfunction messageFromBinary(messageDescriptor, binaryMessage) {\r\n  const protoMessage = messageDescriptor.decode(binaryMessage);\r\n  return messageFromProtoMessage(messageDescriptor, protoMessage, {binary: true});\r\n}\r\n\r\nfunction messageFromBinaryHex(messageDescriptor, hexMessage) {\r\n  const binaryMessageArray = []\r\n  for (var i = 0; i < hexMessage.length; i += 2) {\r\n    binaryMessageArray.push(parseInt(hexMessage.substring(i, i + 2), 16));\r\n  }\r\n  return messageFromBinary(messageDescriptor, new Uint8Array(binaryMessageArray));\r\n}\r\n\r\nfunction messageFromBinaryBase64(messageDescriptor, base64Message) {\r\n  const binaryMessage = window.atob(base64Message);\r\n  return messageFromBinary(messageDescriptor, binaryMessage);\r\n}\r\n\r\nfunction asUTF8(data) {\r\n  if (data instanceof Uint8Array) {\r\n    return new TextDecoder('utf-8').decode(data);\r\n  } else {\r\n    return data;\r\n  }\r\n}\r\n\r\nfunction messageFromJson(messageDescriptor, jsonMessage) {\r\n  const protoMessage = JSON.parse(asUTF8(jsonMessage));\r\n  return messageFromProtoMessage(messageDescriptor, protoMessage);\r\n}\r\n\r\nfunction findConvertedKey(convertedKey, messageDescriptor, convertFunc) {\r\n  for (const key in messageDescriptor.fields) {\r\n    if (convertFunc(key, messageDescriptor).toString() === convertedKey) {\r\n      return key;\r\n    }\r\n  }\r\n  console.error('Failed to match key');\r\n  for (const key in messageDescriptor.fields) {\r\n    console.error('tried', convertFunc(key, messageDescriptor), '===', convertedKey);\r\n  }\r\n  console.error('all false.')\r\n}\r\n\r\nfunction reverseReplaceFieldNames(\r\n  messageDescriptor, convertedMessage, convertFunc) {\r\n    return replaceFieldNames(\r\n      messageDescriptor,\r\n      convertedMessage,\r\n      (convertedKey, messageDescriptor) => findConvertedKey(\r\n        convertedKey, messageDescriptor, convertFunc)\r\n    );\r\n  }\r\n\r\nfunction messageFromJsonCamelCase(messageDescriptor, jsonCamelCaseMessage) {\r\n  const camelCaseMessage = JSON.parse(asUTF8(jsonCamelCaseMessage));\r\n  const protoMessage = reverseReplaceFieldNames(\r\n    messageDescriptor,\r\n    camelCaseMessage,\r\n    (camelCaseFieldName) => {\r\n      return protobuf.util.camelCase(camelCaseFieldName)\r\n    }\r\n  );\r\n  return messageFromProtoMessage(messageDescriptor, protoMessage);\r\n}\r\n\r\nfunction messageFromJsonIds(messageDescriptor, jsonIdsMessage) {\r\n  const idsMessage = JSON.parse(asUTF8(jsonIdsMessage));\r\n  const protoMessage = reverseReplaceFieldNames(\r\n    messageDescriptor,\r\n    idsMessage,\r\n    (fieldId, messageDescriptor) => messageDescriptor.fields[fieldId].id\r\n  );\r\n  return messageFromProtoMessage(messageDescriptor, protoMessage);\r\n}\r\n\r\nfunction messageFromProtoMessage(messageDescriptor, protoMessage, options) {\r\n  return Map(Object.entries(protoMessage).map(([key, value]) => {\r\n    const fieldDescriptor = messageDescriptor.fields[key];\r\n    return [fieldDescriptor.id, valueEntriesFromProto(fieldDescriptor, value, options)];\r\n  }));\r\n}\r\n\r\nfunction valueEntriesFromProto(fieldDescriptor, value, options) {\r\n  if (fieldDescriptor.map) {\r\n    return List(Object.entries(value).map(([key, value]) => ({\r\n      id: shortid.generate(),\r\n      key: valueFromProto(fieldDescriptor.keyType, null, key),\r\n      value: valueFromProto(fieldDescriptor.type, fieldDescriptor.resolvedType, value),\r\n    })));\r\n  }\r\n  const values = fieldDescriptor.repeated ? value : [value];\r\n  return List(\r\n    values.map(v => (Map({\r\n      id: shortid.generate(),\r\n      value: valueFromProto(fieldDescriptor, v, options)\r\n    })))\r\n  );\r\n}\r\n\r\nfunction valueFromProto(fieldDescriptor, protoValue, options) {\r\n  switch (fieldDescriptor.type) {\r\n    case \"bytes\":\r\n    const binary = options && options.binary;\r\n      return (binary\r\n        ? protobuf.util.base64.encode(protoValue, 0, protoValue.length)\r\n        : protoValue\r\n      );\r\n\r\n    case \"string\":\r\n    case \"int32\":\r\n    case \"int64\":\r\n    case \"sint32\":\r\n    case \"sint64\":\r\n    case \"uint32\":\r\n    case \"uint64\":\r\n    case \"fixed32\":\r\n    case \"fixed64\":\r\n    case \"float\":\r\n    case \"double\":\r\n    case \"bool\":\r\n      return protoValue;\r\n    default:\r\n      break;\r\n  }\r\n  const resolvedType = fieldDescriptor.resolvedType;\r\n  if (resolvedType === null) {\r\n    console.error(\"Unhandled value type\", fieldDescriptor);\r\n    return \"\";\r\n  }\r\n  if (resolvedType.constructor === protobuf.Enum) {\r\n    return protoValue;\r\n  } else if (resolvedType.constructor === protobuf.Type) {\r\n    return messageFromProtoMessage(resolvedType, protoValue, options);\r\n  }\r\n  console.error(\"Unhandled value type\", fieldDescriptor);\r\n  return \"\";\r\n}\r\n\r\nfunction defaultValueEntryForField(fieldDescriptor) {\r\n  var valueObject = {\r\n    id: shortid.generate(),\r\n    value: defaultValueForFieldType(fieldDescriptor.type, fieldDescriptor.resolvedType)\r\n  };\r\n  if (fieldDescriptor.map) {\r\n    valueObject.key = defaultValueForFieldType(fieldDescriptor.keyType, null);\r\n  }\r\n  return Map(valueObject);\r\n}\r\n\r\nfunction defaultValueForFieldType(fieldType, resolvedType) {\r\n  switch (fieldType) {\r\n    case \"string\":\r\n    case \"bytes\":\r\n      return \"\";\r\n    case \"int32\":\r\n    case \"int64\":\r\n    case \"sint32\":\r\n    case \"sint64\":\r\n    case \"uint32\":\r\n    case \"uint64\":\r\n    case \"fixed32\":\r\n    case \"fixed64\":\r\n    case \"float\":\r\n    case \"double\":\r\n      return \"0\"\r\n    case \"bool\":\r\n      return false;\r\n    default:\r\n      break;\r\n  }\r\n  if (resolvedType === null) {\r\n    console.error(\"Unhandled default type, expected resolved type\", fieldType);\r\n    return \"\";\r\n  }\r\n  if (resolvedType.constructor === protobuf.Enum) {\r\n    return parseInt(List(Object.keys(resolvedType.valuesById)).sort().first(), 10);\r\n  } else if (resolvedType.constructor === protobuf.Type) {\r\n    return Map();\r\n  }\r\n  console.error(\"Unhandled default type\", fieldType);\r\n  return \"\";\r\n}\r\n\r\nfunction fullMessageDescriptorName(messageDescriptor) {\r\n  if (!messageDescriptor) {\r\n    return \"\";\r\n  }\r\n  var name = messageDescriptor.name;\r\n  while (messageDescriptor.parent && messageDescriptor.parent.name) {\r\n    name = messageDescriptor.parent.name + '.' + name;\r\n    messageDescriptor = messageDescriptor.parent;\r\n  }\r\n  return name;\r\n}\r\n\r\nexport {\r\n  converterFormats,\r\n  converterName,\r\n  converterExtension,\r\n  convertTo,\r\n  convertFrom,\r\n  defaultValueEntryForField,\r\n  fullMessageDescriptorName,\r\n  messageToProto\r\n};\r\n","const { fromJS, isKeyed } = require('immutable');\r\n\r\nconst tryParseToInt = v => {\r\n  if (/^[0-9]+$/.test(v)) {\r\n    return parseInt(v);\r\n  }\r\n  return v;\r\n}\r\n\r\nconst reviver = (key, value) => {\r\n  if (!isKeyed(value)) {\r\n    return value.toList();\r\n  }\r\n  return value.mapEntries(([k, v]) => [tryParseToInt(k), v]).toMap();\r\n}\r\n\r\nconst loadJson = keyName => {\r\n  const data = fromJS(\r\n    JSON.parse(window.localStorage.getItem(keyName) || \"{}\"),\r\n    reviver);\r\n  console.log('Loaded', keyName, data);\r\n  return data;\r\n}\r\n\r\nconst saveJson = (keyName, data) => {\r\n  if (data.isEmpty()) {\r\n    console.log('Removing', keyName, data);\r\n    window.localStorage.removeItem(keyName);\r\n  } else {\r\n    console.log('Saving', keyName, data);\r\n    window.localStorage.setItem(keyName, JSON.stringify(data.toJSON()));\r\n  }\r\n}\r\n\r\nconst protos = {\r\n  load: () => loadJson('stored_protos'),\r\n  save: rawStoredProtos => saveJson('stored_protos', rawStoredProtos)\r\n};\r\n\r\nconst messages = {\r\n  load: () => loadJson('stored_messages'),\r\n  save: messages => saveJson('stored_messages', messages)\r\n}\r\n\r\nconst format = {\r\n  load: () => {\r\n    return window.localStorage.getItem('format') || 'binary';\r\n  },\r\n  save: format => {\r\n    if (format === 'binary') {\r\n      window.localStorage.removeItem('format');\r\n    } else {\r\n      window.localStorage.setItem('format', format);\r\n    }\r\n  }\r\n}\r\n\r\nconst config = {\r\n  load: () => loadJson('config'),\r\n  save: config => saveJson('config', config),\r\n}\r\n\r\nexport default {protos, messages, format, config};\r\n","import React from 'react';\r\nconst protobuf = require(\"protobufjs\");\r\nconst shortid = require('shortid');\r\nconst ProtoConvert = require('../ProtoConvert')\r\n\r\nconst { List, Map } = require('immutable');\r\n\r\nclass MessageBuilderScaffold extends React.Component {\r\n  handleSelectMessage = (message) => {\r\n    this.props.callbacks.onSet(List(), message);\r\n  }\r\n\r\n  render() {\r\n    if (this.props.messageDescriptor === undefined) {\r\n      return null;\r\n    }\r\n    const path = List();\r\n    return (\r\n      <React.Fragment>\r\n        <div className=\"message-builder\">\r\n          <div className=\"inner-message-builder\">\r\n          <h1>\r\n            {this.props.messageDescriptor.name} builder\r\n          </h1>\r\n          <StoreMessageButton\r\n            path={path}\r\n            messageDescriptor={this.props.messageDescriptor}\r\n            callbacks={this.props.callbacks}/>\r\n          <StoredMessageSelector\r\n            path={path}\r\n            storedMessages={this.props.storedMessages}\r\n            messageDescriptor={this.props.messageDescriptor}\r\n            shouldSet={true}\r\n            onSelectMessage={this.handleSelectMessage} />\r\n          <MessageFieldsBuilder\r\n            path={path}\r\n            storedMessages={this.props.storedMessages}\r\n            messageDescriptor={this.props.messageDescriptor}\r\n            values={this.props.message}\r\n            callbacks={this.props.callbacks} />\r\n          </div>\r\n        </div>\r\n        <div className=\"output\">\r\n          <Output\r\n            messageDescriptor={this.props.messageDescriptor}\r\n            format={this.props.format}\r\n            builtMessage={this.props.builtMessage}\r\n            buildMessageUpToDate={this.props.buildMessageUpToDate}\r\n            callbacks={this.props.callbacks} />\r\n        </div>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nclass StoredMessageSelector extends React.Component {\r\n\r\n  fullMessageDescriptorName = () => ProtoConvert.fullMessageDescriptorName(\r\n    this.props.messageDescriptor);\r\n\r\n  handleSelectMessage = (event) => {\r\n    const name = event.target.value;\r\n    if (name === '') {\r\n      return;\r\n    }\r\n    const message = this.props.storedMessages.getIn(\r\n      [this.fullMessageDescriptorName(), name]);\r\n    this.props.onSelectMessage(message);\r\n    event.target.value = '';\r\n  }\r\n\r\n  render() {\r\n    const storedMessages = this.props.storedMessages.get(\r\n      this.fullMessageDescriptorName()) || Map();\r\n    if (storedMessages.isEmpty()) {\r\n      return null;\r\n    }\r\n    return (\r\n      <select onChange={this.handleSelectMessage}>\r\n        <option value=''>Stored message</option>\r\n        {storedMessages.keySeq().map((name) =>\r\n          <option key={name} value={name}>\r\n            {name}\r\n          </option>\r\n        )}\r\n      </select>\r\n    );\r\n  }\r\n}\r\n\r\nclass Output extends React.Component {\r\n  handleExportToFile = () => this.props.callbacks.onExport('file');\r\n\r\n  handleChangeFormat = (event) =>\r\n    this.props.callbacks.onSetFormat(event.target.value);\r\n\r\n  handleFileChange = (event) => {\r\n    const file = event.target.files[0];\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      const fileData = new Uint8Array(reader.result);\r\n      this.props.callbacks.onImport(fileData);\r\n    };\r\n    reader.onerror = (err) =>\r\n      console.error('FileLoading of', file, 'failed:', err);\r\n    reader.readAsArrayBuffer(file);\r\n  }\r\n\r\n  handleImportFromFile = () => this.refs.fileuploader.click();\r\n\r\n  handleChangeBuiltMessage = (event) => {\r\n    const value = this.props.format === 'binary' ? new Uint8Array(event.target.value.split(',')) : event.target.value;\r\n    this.props.callbacks.onImport(value);\r\n  }\r\n\r\n  renderControls() {\r\n    return (\r\n      <div className=\"io-controls\">\r\n        <div>\r\n          Format:\r\n          <select\r\n            onChange={this.handleChangeFormat}\r\n            defaultValue={this.props.format}>\r\n            {ProtoConvert.converterFormats.map(key =>\r\n              <option key={key} value={key}>\r\n                {ProtoConvert.converterName(key)}\r\n              </option>\r\n            )}\r\n          </select>\r\n        </div>\r\n        <div>\r\n          import\r\n          <button onClick={this.handleImportFromFile}>Load from file</button>\r\n          <input\r\n            type=\"file\"\r\n            ref=\"fileuploader\"\r\n            onChange={this.handleFileChange}\r\n            hidden />\r\n        </div>\r\n        <div>\r\n          export\r\n          <button onClick={this.handleExportToFile}> Save as file </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const builtMessage = this.props.builtMessage[0]\r\n    const errorMessage = builtMessage === null ? this.props.builtMessage[1] : null;\r\n    return (\r\n      <div className=\"inner-output\">\r\n        {this.renderControls()}\r\n        <textarea\r\n          value={errorMessage || builtMessage}\r\n          className={builtMessage === null ? \"invalid area\" : \"area\"}\r\n          disabled={!this.props.buildMessageUpToDate}\r\n          onChange={this.handleChangeBuiltMessage} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nclass StoreMessageButton extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      isStoring: false,\r\n    }\r\n  }\r\n\r\n  handleStartStoring = () => {\r\n    this.setState({\r\n      isStoring: true\r\n    });\r\n  }\r\n\r\n  handleCommitStore = () => {\r\n    const storeName = this.refs.storeName.value;\r\n    const fullMessageDescriptorName = ProtoConvert.fullMessageDescriptorName(\r\n      this.props.messageDescriptor\r\n    );\r\n    this.props.callbacks.onStore(\r\n      this.props.path,\r\n      fullMessageDescriptorName,\r\n      storeName\r\n    );\r\n    this.setState({isStoring: false});\r\n  }\r\n\r\n  handleDiscardStore = () => {\r\n    this.setState({isStoring: false});\r\n  }\r\n\r\n  render() {\r\n    const messageDescriptor = this.props.messageDescriptor;\r\n    if (!messageDescriptor || messageDescriptor.constructor !== protobuf.Type) {\r\n      return null;\r\n    }\r\n    if (!this.state.isStoring) {\r\n      return (\r\n        <button onClick={this.handleStartStoring}>\r\n          store\r\n        </button>\r\n      );\r\n    }\r\n    return (\r\n      <React.Fragment>\r\n        Store as <input type=\"text\" ref=\"storeName\"/>\r\n        <button onClick={this.handleDiscardStore}>cancel</button>\r\n        <button onClick={this.handleCommitStore}>store</button>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nclass MessageFieldsBuilder extends React.Component {\r\n\r\n  isRegularField = fieldDescriptor => fieldDescriptor.partOf === null;\r\n\r\n  fieldTypeName = (fieldDescriptor) => {\r\n    const type = fieldDescriptor.type;\r\n    if (fieldDescriptor.map) {\r\n      const keyType = fieldDescriptor.keyType;\r\n      return 'map<' + keyType + ',' + type + '>';\r\n    }\r\n    const repeated = fieldDescriptor.repeated ? '*' : '';\r\n    const required = fieldDescriptor.required ? '!' : '';\r\n    return type + repeated + required;\r\n  }\r\n\r\n  render() {\r\n    const regularFieldDescriptors = Object\r\n      .values(this.props.messageDescriptor.fields)\r\n      .filter(this.isRegularField);\r\n    const oneOfDescriptors = Object\r\n      .values(this.props.messageDescriptor.oneofs || {});\r\n\r\n    const regularFieldItems = regularFieldDescriptors.map(fieldDescriptor =>\r\n      <li key={fieldDescriptor.name}>\r\n        <b>{this.fieldTypeName(fieldDescriptor)}</b> - {fieldDescriptor.name} = {fieldDescriptor.id}\r\n        <MessageFieldValuesBuilder\r\n          path={this.props.path.concat([fieldDescriptor.id])}\r\n          storedMessages={this.props.storedMessages}\r\n          fieldDescriptor={fieldDescriptor}\r\n          valueEntries={this.props.values.get(fieldDescriptor.id) || List()}\r\n          callbacks={this.props.callbacks} />\r\n      </li>\r\n    );\r\n\r\n    const oneOfItems = oneOfDescriptors.map(oneOfDescriptor =>\r\n      <li key={oneOfDescriptor.name}>\r\n        <b>oneof</b> {oneOfDescriptor.name}\r\n        <MessageOneOfFieldValuesBuilder\r\n          path={this.props.path}\r\n          storedMessages={this.props.storedMessages}\r\n          messageDescriptor={this.props.messageDescriptor}\r\n          oneOfDescriptor={oneOfDescriptor}\r\n          values={this.props.values}\r\n          callbacks={this.props.callbacks} />\r\n      </li>\r\n    );\r\n\r\n    return (\r\n      <ul>\r\n        {regularFieldItems}\r\n        {oneOfItems}\r\n      </ul>\r\n    );\r\n  }\r\n}\r\n\r\nclass MessageFieldValuesBuilder extends React.Component{\r\n  render() {\r\n    const messageFieldValueBuilders = this.props.valueEntries.map((valueEntry, index) =>\r\n      <MessageFieldValueBuilder\r\n        key={valueEntry.get('id')}\r\n        path={this.props.path}\r\n        storedMessages={this.props.storedMessages}\r\n        index={index}\r\n        numEntries={this.props.valueEntries.size}\r\n        fieldDescriptor={this.props.fieldDescriptor}\r\n        valueEntry={valueEntry}\r\n        callbacks={this.props.callbacks} />\r\n    );\r\n\r\n    return (\r\n      <ul>\r\n        {messageFieldValueBuilders}\r\n        <MessageFieldValuesAddControls\r\n          path={this.props.path}\r\n          storedMessages={this.props.storedMessages}\r\n          fieldDescriptor={this.props.fieldDescriptor}\r\n          numValueEntries={this.props.valueEntries.size}\r\n          callbacks={this.props.callbacks} />\r\n      </ul>\r\n    );\r\n  }\r\n}\r\n\r\nclass MessageFieldValuesAddControls extends React.Component {\r\n  handleSet = () => {\r\n    this.props.callbacks.onAdd(\r\n      this.props.path,\r\n      ProtoConvert.defaultValueEntryForField(this.props.fieldDescriptor));\r\n  }\r\n\r\n  handleSelectMessage = (message) => {\r\n    const valueEntry = Map({\r\n      id: shortid.generate(),\r\n      value: message,\r\n    });\r\n    this.props.callbacks.onAdd(this.props.path, valueEntry);\r\n  }\r\n\r\n  render() {\r\n    const showSet = this.props.numValueEntries === 0;\r\n    const showAdd = this.props.fieldDescriptor.repeated || this.props.fieldDescriptor.map;\r\n    if (!showSet && !showAdd) {\r\n      return null;\r\n    }\r\n    return (\r\n      <li>\r\n        <button onClick={this.handleSet}> {(showAdd) ? 'add' : 'set'} </button>\r\n        <StoredMessageSelector\r\n          path={this.props.path}\r\n          storedMessages={this.props.storedMessages}\r\n          messageDescriptor={this.props.fieldDescriptor.resolvedType}\r\n          onSelectMessage={this.handleSelectMessage} />\r\n      </li>\r\n    );\r\n  }\r\n}\r\n\r\nclass MessageFieldValueBuilder extends React.Component{\r\n  handleDelete = () =>\r\n    this.props.callbacks.onDelete(this.props.path.concat([this.props.index]));\r\n\r\n  handleDuplicate = () => {\r\n    this.props.callbacks.onAdd(\r\n      this.props.path,\r\n      this.props.valueEntry.set('id', shortid.generate())\r\n    );\r\n  }\r\n\r\n  handleMoveUp = () => {\r\n    this.props.callbacks.onMove(this.props.path, this.props.index, this.props.index - 1);\r\n  }\r\n\r\n  handleMoveDown = () => {\r\n    this.props.callbacks.onMove(this.props.path, this.props.index, this.props.index + 1);\r\n  }\r\n\r\n  render() {\r\n    const showDelete = this.props.fieldDescriptor.partOf === null;\r\n    const showDuplicate = this.props.fieldDescriptor.repeated || this.props.fieldDescriptor.map;\r\n    const showMove = this.props.fieldDescriptor.repeated;\r\n    const enableMoveDown = this.props.index !== this.props.numEntries - 1;\r\n    const enableMoveUp = this.props.index !== 0;\r\n    return (\r\n      <li key={this.props.valueEntry.get('id')}>\r\n        <button\r\n          onClick={this.handleDelete}\r\n          hidden={!showDelete}\r\n          className=\"tiny\">\r\n          -\r\n        </button>\r\n        <button\r\n          onClick={this.handleDuplicate}\r\n          hidden={!showDuplicate}\r\n          className=\"tiny\">\r\n          *\r\n        </button>\r\n        <button\r\n          onClick={this.handleMoveDown}\r\n          hidden={!showMove}\r\n          disabled={!enableMoveDown}\r\n          className=\"tiny\">\r\n          v\r\n        </button>\r\n        <button\r\n          onClick={this.handleMoveUp}\r\n          hidden={!showMove}\r\n          disabled={!enableMoveUp}\r\n          className=\"tiny\">\r\n          ^\r\n        </button>\r\n        <StoreMessageButton\r\n          path={this.props.path.concat([this.props.index, 'value'])}\r\n          messageDescriptor={this.props.fieldDescriptor.resolvedType}\r\n          callbacks={this.props.callbacks} />\r\n        {\r\n          this.props.fieldDescriptor.map\r\n          ? <MessageFieldInput\r\n              path={this.props.path.concat([this.props.index, 'key'])}\r\n              storedMessages={this.props.storedMessages}\r\n              fieldType={this.props.fieldDescriptor.keyType}\r\n              resolvedType={null}\r\n              value={this.props.valueEntry.get('key')}\r\n              callbacks={this.props.callbacks} />\r\n          : <React.Fragment />\r\n        }\r\n        <MessageFieldInput\r\n          path={this.props.path.concat([this.props.index, 'value'])}\r\n          storedMessages={this.props.storedMessages}\r\n          fieldType={this.props.fieldDescriptor.type}\r\n          resolvedType={this.props.fieldDescriptor.resolvedType}\r\n          value={this.props.valueEntry.get('value')}\r\n          callbacks={this.props.callbacks} />\r\n      </li>\r\n    );\r\n  }\r\n}\r\n\r\nclass MessageOneOfFieldValuesBuilder extends React.Component {\r\n\r\n  currentFieldDescriptor = () => {\r\n    const maybeCurrentFieldId = this.props.values.keySeq().find(\r\n      fieldId => this.props.messageDescriptor.fieldsById[fieldId].partOf === this.props.oneOfDescriptor);\r\n    if (maybeCurrentFieldId === undefined) {\r\n      return null;\r\n    }\r\n    return this.props.messageDescriptor.fieldsById[maybeCurrentFieldId];\r\n  }\r\n\r\n  onChange = (event) => {\r\n    const currentFieldDescriptor = this.currentFieldDescriptor();\r\n    if (currentFieldDescriptor !== null) {\r\n      this.props.callbacks.onDelete(this.props.path.concat([currentFieldDescriptor.id, 0]));\r\n    }\r\n    if (event.target.value.length !== 0) {\r\n      const newFieldId = parseInt(event.target.value, 10);\r\n      const newFieldDescriptor = this.props.messageDescriptor.fieldsById[newFieldId];\r\n      this.props.callbacks.onAdd(\r\n        this.props.path.concat([newFieldDescriptor.id]),\r\n        ProtoConvert.defaultValueEntryForField(newFieldDescriptor)\r\n      );\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const maybeCurrentFieldDescriptor = this.currentFieldDescriptor();\r\n    return (\r\n      <React.Fragment>\r\n        <ul>\r\n          <li>\r\n            <select\r\n              value={maybeCurrentFieldDescriptor !== null ? maybeCurrentFieldDescriptor.id : ''}\r\n              onChange={this.onChange}>\r\n              <option value={''}></option>\r\n              {this.props.oneOfDescriptor.fieldsArray.map(\r\n                (fieldDescriptor) => (\r\n                  <option\r\n                    key={fieldDescriptor.id}\r\n                    value={fieldDescriptor.id}>\r\n                    {fieldDescriptor.type} - {fieldDescriptor.name} = {fieldDescriptor.id}\r\n                  </option>\r\n                )\r\n              )}\r\n            </select>\r\n            {(maybeCurrentFieldDescriptor !== null\r\n              ? <MessageFieldValuesBuilder\r\n                  path={this.props.path.concat([maybeCurrentFieldDescriptor.id])}\r\n                  storedMessages={this.props.storedMessages}\r\n                  fieldDescriptor={maybeCurrentFieldDescriptor}\r\n                  valueEntries={this.props.values.get(maybeCurrentFieldDescriptor.id) || List()}\r\n                  callbacks={this.props.callbacks} />\r\n              : <React.Fragment />\r\n            )}\r\n          </li>\r\n        </ul>\r\n\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nclass MessageFieldInput extends React.Component {\r\n  render() {\r\n    switch (this.props.fieldType) {\r\n      case \"string\":\r\n        return <MessageTextInput\r\n          path={this.props.path}\r\n          value={this.props.value}\r\n          callbacks={this.props.callbacks} />\r\n      case \"bytes\":\r\n        return <MessageBytesInput\r\n          path={this.props.path}\r\n          value={this.props.value}\r\n          callbacks={this.props.callbacks} />\r\n      case \"int32\":\r\n      case \"int64\":\r\n      case \"sint32\":\r\n      case \"sint64\":\r\n      case \"uint32\":\r\n      case \"uint64\":\r\n      case \"fixed32\":\r\n      case \"fixed64\":\r\n        return <MessageIntInput\r\n          path={this.props.path}\r\n          value={this.props.value}\r\n          callbacks={this.props.callbacks} />\r\n      case \"float\":\r\n      case \"double\":\r\n        return <MessageFloatInput\r\n          path={this.props.path}\r\n          value={this.props.value}\r\n          callbacks={this.props.callbacks} />\r\n      case \"bool\":\r\n        return <MessageBoolInput\r\n          path={this.props.path}\r\n          value={this.props.value}\r\n          callbacks={this.props.callbacks} />\r\n      default:\r\n        break;\r\n    }\r\n    const resolvedType = this.props.resolvedType;\r\n    if (resolvedType.constructor === protobuf.Enum) {\r\n      return <MessageEnumInput\r\n        path={this.props.path}\r\n        type={resolvedType}\r\n        value={this.props.value}\r\n        callbacks={this.props.callbacks} />\r\n    } else if (resolvedType.constructor === protobuf.Type) {\r\n      return <MessageFieldsBuilder\r\n        path={this.props.path}\r\n        storedMessages={this.props.storedMessages}\r\n        messageDescriptor={resolvedType}\r\n        values={this.props.value}\r\n        callbacks={this.props.callbacks} />\r\n    }\r\n    console.error(\"Unhandled input type\", this.props.fieldType);\r\n    return <div/>\r\n  }\r\n}\r\n\r\nclass MessageTextInput extends React.Component {\r\n  handleChange = (event) => {\r\n    // console.log('MessageTextInput change', this.props.path, event.target.value);\r\n    this.props.callbacks.onSet(this.props.path, event.target.value);\r\n  }\r\n\r\n  render() {\r\n    return <textarea onChange={this.handleChange} value={this.props.value} />\r\n  }\r\n}\r\n\r\nclass MessageBytesInput extends React.Component {\r\n  isValid = () => protobuf.util.base64.test(this.props.value);\r\n\r\n  handleChange = (event) => {\r\n    // console.log(\"MessageBytesInput change\", this.props.path, event.target.value);\r\n    this.props.callbacks.onSet(this.props.path, event.target.value);\r\n  }\r\n\r\n  render() {\r\n    const isValid = this.isValid();\r\n    return (\r\n      <textarea\r\n        onChange={this.handleChange}\r\n        value={this.props.value}\r\n        className={isValid ? \"\" : \"invalid\"} />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nclass MessageIntInput extends React.Component {\r\n  isValid = () => /^[0-9]+$/.test(this.props.value);\r\n\r\n  handleChange = (event) => {\r\n    // console.log('MessageIntInput change', this.props.path, event.target.value);\r\n    this.props.callbacks.onSet(this.props.path, event.target.value);\r\n  }\r\n\r\n  render() {\r\n    const isValid = this.isValid();\r\n    return (\r\n      <input\r\n        type=\"text\"\r\n        onChange={this.handleChange}\r\n        value={this.props.value}\r\n        className={isValid ? \"\" : \"invalid\"} />\r\n    );\r\n  }\r\n}\r\n\r\nclass MessageFloatInput extends React.Component {\r\n  isValid = () =>\r\n    /^[0-9]+$|^[0-9]+[.][0-9]*$|^[0-9]*[.][0-9]+$/.test(this.props.value);\r\n\r\n  handleChange = (event) => {\r\n    // console.log('MessageFloatInput change', this.props.path, event.target.value);\r\n    this.props.callbacks.onSet(this.props.path, event.target.value);\r\n  }\r\n\r\n  render() {\r\n    const isValid = this.isValid();\r\n    return (\r\n      <input\r\n        type=\"text\"\r\n        onChange={this.handleChange}\r\n        value={this.props.value}\r\n        className={isValid ? \"\" : \"invalid\"} />\r\n    );\r\n  }\r\n}\r\n\r\nclass MessageBoolInput extends React.Component {\r\n  handleChange = (event) => {\r\n    // console.log('MessageBoolInput', this.props.path, event.target.checked);\r\n    this.props.callbacks.onSet(this.props.path, event.target.checked);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <input\r\n        type=\"checkbox\"\r\n        checked={this.props.value}\r\n        onChange={this.handleChange} />\r\n    )\r\n  }\r\n}\r\n\r\nclass MessageEnumInput extends React.Component {\r\n  handleChange = (event) => {\r\n    const value = parseInt(event.target.value);\r\n    // console.log('MessageEnumInput.change', this.props.path, typeof(value), value);\r\n    this.props.callbacks.onSet(this.props.path, value);\r\n  }\r\n\r\n  render() {\r\n    const keys = List(Object.keys(this.props.type.valuesById)).sort();\r\n    return (\r\n      <select defaultValue={this.props.value} onChange={this.handleChange}>\r\n        {keys.map(key => (\r\n          <option value={key} key={key}>\r\n            {this.props.type.valuesById[key]} = {key}\r\n          </option>\r\n        ))}\r\n      </select>\r\n    )\r\n  }\r\n}\r\n\r\nexport default MessageBuilderScaffold;\r\n","import React from 'react';\r\nconst ProtoConvert =  require('../ProtoConvert');\r\nconst protobuf = require(\"protobufjs\");\r\nconst { List } = require('immutable');\r\n\r\nclass ProtoLibrary extends React.Component {\r\n  render() {\r\n    return (\r\n      <div className=\"inner-proto-library\">\r\n        <h2>\r\n          Known messages\r\n        </h2>\r\n        <ProtoRoot\r\n          protoRoot={this.props.protoRoot}\r\n          storedMessages={this.props.storedMessages}\r\n          callbacks={this.props.callbacks} />\r\n        <h2>\r\n          Known files\r\n        </h2>\r\n        <ProtoFiles\r\n          filenames={this.props.filenames}\r\n          fileDependencies={this.props.fileDependencies}\r\n          callbacks={this.props.callbacks} />\r\n        <ProtoInput callbacks={this.props.callbacks} />\r\n        <ProtoUpload callbacks={this.props.callbacks} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nclass ProtoRoot extends React.Component {\r\n  render() {\r\n    if (!this.props.protoRoot) {\r\n      return <React.Fragment />;\r\n    }\r\n    return <ProtoNamespace\r\n      name={''}\r\n      namespace={this.props.protoRoot}\r\n      storedMessages={this.props.storedMessages}\r\n      callbacks={this.props.callbacks} />\r\n  }\r\n}\r\n\r\nclass ProtoNamespace extends React.Component {\r\n  handleBuild = () =>\r\n    this.props.callbacks.onSelectMessageDescriptor(this.props.namespace);\r\n\r\n  render() {\r\n    const nested = this.props.namespace.nested || {};\r\n    const entries = Object.entries(nested);\r\n    const namespaces = entries.filter(([k, v]) => v.constructor === protobuf.Namespace);\r\n    const types = entries.filter(([k, v]) => v.constructor === protobuf.Type);\r\n\r\n    if (this.props.namespace.constructor === protobuf.Namespace) {\r\n      const baseName = this.props.name ? this.props.name + '.' : '';\r\n      if (namespaces.length === 1 && types.length === 0) {\r\n        const [subNamespaceName, subNamespace] = namespaces[0];\r\n        return <ProtoNamespace\r\n          name={baseName + subNamespaceName}\r\n          namespace={subNamespace}\r\n          storedMessages={this.props.storedMessages}\r\n          callbacks={this.props.callbacks} />\r\n      } else if (namespaces.length === 0 && types.length === 1) {\r\n        const [subMessageName, subMessage] = types[0];\r\n        return <ProtoMessage\r\n          name={baseName + subMessageName}\r\n          message={subMessage}\r\n          storedMessages={this.props.storedMessages}\r\n          callbacks={this.props.callbacks} />;\r\n      }\r\n    }\r\n\r\n    return (\r\n      <React.Fragment>\r\n        {this.props.name}\r\n        <button\r\n          onClick={this.handleBuild}\r\n          hidden={!this.props.buildable}>\r\n          build\r\n        </button>\r\n        <ul>\r\n          {namespaces.map(([k ,v]) =>\r\n            <li key={k} >\r\n              <ProtoNamespace\r\n                name={k}\r\n                namespace={v}\r\n                storedMessages={this.props.storedMessages}\r\n                callbacks={this.props.callbacks} />\r\n            </li>\r\n          )}\r\n          {types.map(([k, v]) =>\r\n            <li key={k}>\r\n              <ProtoMessage\r\n                name={k}\r\n                message={v}\r\n                storedMessages={this.props.storedMessages}\r\n                callbacks={this.props.callbacks} />\r\n            </li>\r\n           )}\r\n        </ul>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nclass ProtoMessage extends React.Component {\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <ProtoNamespace\r\n          name={this.props.name}\r\n          namespace={this.props.message}\r\n          buildable={true}\r\n          storedMessages={this.props.storedMessages}\r\n          callbacks={this.props.callbacks} />\r\n        <StoredMessages\r\n          storedMessages={this.props.storedMessages}\r\n          messageDescriptor={this.props.message}\r\n          callbacks={this.props.callbacks} />\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nclass ProtoFiles extends React.Component {\r\n  render() {\r\n    return (\r\n      <ul>\r\n        {this.props.filenames.sort().map(filename =>\r\n          <li key={filename}>\r\n            <ProtoFile\r\n              filename={filename}\r\n              fileDependencies={this.props.fileDependencies}\r\n              callbacks={this.props.callbacks} />\r\n          </li>\r\n        )}\r\n      </ul>\r\n    );\r\n  }\r\n}\r\n\r\nclass ProtoFile extends React.Component {\r\n  handleClick = () => {\r\n    this.props.callbacks.onRemoveProto(this.props.filename);\r\n  }\r\n\r\n  render() {\r\n    const fileDependents = this.props.fileDependencies.get(this.props.filename, List());\r\n\r\n    const importingFiles = (fileDependents.isEmpty()\r\n      ? <React.Fragment />\r\n      : <ProtoFiles\r\n          filenames={fileDependents}\r\n          fileDependencies={this.props.fileDependencies}\r\n          callbacks={this.props.callbacks}/>);\r\n\r\n    return (\r\n      <React.Fragment>\r\n        <button\r\n          onClick={this.handleClick}\r\n          disabled={!fileDependents.isEmpty()}\r\n          className=\"tiny\">\r\n           -\r\n        </button>\r\n        {this.props.filename}\r\n        {importingFiles}\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nclass StoredMessages extends React.Component {\r\n  render() {\r\n    const fullMessageDescriptorName = ProtoConvert.fullMessageDescriptorName(this.props.messageDescriptor)\r\n    const storedMessages = this.props.storedMessages.get(fullMessageDescriptorName);\r\n    if (!storedMessages) {\r\n      return null;\r\n    }\r\n    return (\r\n      <ul>\r\n        {storedMessages.keySeq().map(name =>\r\n          <StoredMessage\r\n            key={name}\r\n            name={name}\r\n            messageDescriptor={this.props.messageDescriptor}\r\n            callbacks={this.props.callbacks} />\r\n        )}\r\n      </ul>\r\n    );\r\n  }\r\n}\r\n\r\nclass StoredMessage extends React.Component {\r\n  handleRemove = (event) => {\r\n    this.props.callbacks.onRemoveStoredMessage(\r\n      ProtoConvert.fullMessageDescriptorName(this.props.messageDescriptor),\r\n      this.props.name\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <li>\r\n        <button onClick={this.handleRemove} className='tiny'>\r\n        -\r\n        </button>\r\n        {this.props.name}\r\n      </li>\r\n    );\r\n  }\r\n}\r\n\r\nclass ProtoInput extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isAdding: false\r\n    }\r\n  }\r\n\r\n  handleStartAdding = () => this.setState({isAdding: true});\r\n\r\n  handleSubmit = () => {\r\n    const fileName = this.refs.fileName.value;\r\n    const protoContent = this.refs.protoText.value;\r\n    this.setState({isAdding: false});\r\n    this.props.callbacks.onAddProto(fileName, protoContent);\r\n  }\r\n\r\n  render() {\r\n    if (!this.state.isAdding) {\r\n      return <button onClick={this.handleStartAdding} > Add </button>\r\n    }\r\n    return (\r\n      <React.Fragment>\r\n        File name: <input type=\"text\" ref=\"fileName\" /> <br />\r\n        ProtoContent: <br />\r\n        <textarea ref=\"protoText\"/> <br />\r\n        <button onClick={this.handleSubmit} > Submit </button>\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nclass ProtoUpload extends React.Component {\r\n  handleFileChange = (event) => {\r\n    const file = event.target.files[0];\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      const text = reader.result;\r\n      this.props.callbacks.onAddProto(file.name, text);\r\n    };\r\n    reader.onerror = (err) => {\r\n      console.error('FileLoading of', file, 'failed:', err);\r\n    };\r\n    reader.readAsText(file);\r\n  }\r\n\r\n  handleClick = () => this.refs.fileuploader.click();\r\n\r\n  render() {\r\n    return (\r\n      <React.Fragment>\r\n        <button onClick={this.handleClick}>\r\n          From disk\r\n        </button>\r\n        <input\r\n          type=\"file\"\r\n          ref=\"fileuploader\"\r\n          onChange={this.handleFileChange}\r\n          hidden />\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ProtoLibrary;\r\n","import React from 'react';\r\nimport LocalStorage from '../LocalStorage'\r\nimport MessageBuilderScaffold from './MessageBuilder';\r\nimport ProtoLibrary from './ProtoLibrary';\r\nconst ProtoConvert = require('../ProtoConvert')\r\nconst protobuf = require(\"protobufjs\");\r\nconst FileSaver = require(\"file-saver\");\r\nconst { List, Map } = require('immutable');\r\n\r\nfunction loadStoredProtos(rawStoredProtos) {\r\n  // Cheat a bit so that we can load files synchronously\r\n  protobuf.util.isNode = true;\r\n  protobuf.util.fs = {\r\n    readFileSync: (filename) => {\r\n      const storedProto = rawStoredProtos.get(filename);\r\n      if (storedProto === undefined) {\r\n        throw new Error('Needed to load unknown file: ' + filename);\r\n      }\r\n      return storedProto.get('contents');\r\n    }\r\n  };\r\n\r\n  const protoRoot = new protobuf.Root();\r\n  const filenames = rawStoredProtos.keySeq().toList();\r\n  protoRoot.loadSync(filenames.toJS(), { keepCase: true });\r\n\r\n  const importEntries = List(filenames.flatMap(filename => {\r\n    const imports = protobuf.parse(\r\n      rawStoredProtos.get(filename).get('contents')\r\n    ).imports || [];\r\n    return imports.map(importName => [importName, filename]);\r\n  }));\r\n  const groupedEntries = importEntries\r\n    .groupBy(([importName, filename]) => importName)\r\n  const mappedEntries = groupedEntries\r\n    .map(importNameAndFilenames => {\r\n      const filenames = importNameAndFilenames.map(([importName, filename]) => filename);\r\n      const filenameSet = filenames.toSet();\r\n      return filenameSet;\r\n    });\r\n  const fileDependencies = mappedEntries;\r\n\r\n  protoRoot.resolveAll();\r\n\r\n  return {protoRoot, fileDependencies};\r\n}\r\n\r\nclass Main extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      config: Map(),\r\n      rawStoredProtos: Map(),\r\n      protoRoot: null,\r\n      fileDependencies: Map(),\r\n      rawStoredMessages: Map(),\r\n      message: Map(),\r\n      format: 'binary',\r\n      builtMessage: ['', null],\r\n    }\r\n    this.libraryCallbacks = {\r\n      onAddProto: this.handleAddProto,\r\n      onRemoveProto: this.handleRemoveProto,\r\n      onSelectMessageDescriptor: this.handleSelectMessageDescriptor,\r\n      onRemoveStoredMessage: this.handleRemoveStoredMessage,\r\n    };\r\n    this.messageBuilderCallbacks = {\r\n      onAdd: this.handleAddToMessage,\r\n      onDelete: this.handleDeleteFromMessage,\r\n      onSet: this.handleSetInMessage,\r\n      onMove: this.handleMoveInMessage,\r\n      onStore: this.handleStoreMessage,\r\n      onSetFormat: this.handleSetFormat,\r\n      onExport: this.handleExportMessage,\r\n      onImport: this.handleImportMessage,\r\n    };\r\n  }\r\n\r\n  isNightModeEnabled = () => {\r\n    return !this.state.config.get('day-mode');\r\n  }\r\n\r\n  handleToggleNightMode = () => {\r\n    this.setState((state) => ({\r\n      config: state.config.set('day-mode', !state.config.get('day-mode'))\r\n    }));\r\n  }\r\n\r\n  handleAddProto = (fileName, protoContent) => {\r\n    this.setState((state) => {\r\n      const rawStoredProtos = state.rawStoredProtos.setIn([fileName], Map({contents: protoContent}));\r\n      const {protoRoot, fileDependencies} = loadStoredProtos(rawStoredProtos);\r\n      return {rawStoredProtos, protoRoot, fileDependencies};\r\n    });\r\n  }\r\n\r\n  handleRemoveProto = (fileName) => {\r\n    // console.log('handleRemoveProto', this.state.rawStoredProtos.toString());\r\n    this.setState((state) => {\r\n      const rawStoredProtos = state.rawStoredProtos.delete(fileName);\r\n      const {protoRoot, fileDependencies} = loadStoredProtos(rawStoredProtos);\r\n      return {rawStoredProtos, protoRoot, fileDependencies};\r\n    });\r\n  }\r\n\r\n  handleSelectMessageDescriptor = (messageDescriptor) => {\r\n    console.log('Setting descriptor to build:', messageDescriptor);\r\n    this.setState({\r\n      messageDescriptor,\r\n      message: Map(),\r\n      builtMessage: ['', null],\r\n      messageBuildTimer: null,\r\n    });\r\n  }\r\n\r\n  handleSetFormat = (format) => {\r\n    this.setState({\r\n      format,\r\n      builtMessage: [\r\n        ProtoConvert.convertTo(\r\n          format,\r\n          this.state.messageDescriptor,\r\n          this.state.message),\r\n        null\r\n      ],\r\n      messageBuildTimer: null,\r\n    });\r\n  }\r\n\r\n  handleExportMessage = (kind) => {\r\n    console.log('Export', this.state.format, 'to', kind);\r\n\r\n    const data = ProtoConvert.convertTo(\r\n      this.state.format,\r\n      this.state.messageDescriptor,\r\n      this.state.message);\r\n    // console.log('data', data);\r\n    console.log('handleExportMessage', this.refs);\r\n\r\n    if (kind === 'file') {\r\n      const extension = ProtoConvert.converterExtension(this.state.format);\r\n      const blob = new Blob([data], {type: 'application/octet-stream'});\r\n      FileSaver.saveAs(blob, this.state.messageDescriptor.name + '.' + extension);\r\n    } else {\r\n      console.error('Unhandled export kind:', kind);\r\n    }\r\n  }\r\n\r\n  handleImportMessage = (data) => {\r\n    console.log('Import', data.length, 'bytes as', this.state.format);\r\n    const message = ProtoConvert.convertFrom(\r\n      this.state.format,\r\n      this.state.messageDescriptor,\r\n      data\r\n    );\r\n    this.setState({\r\n      message,\r\n      builtMessage: [\r\n        ProtoConvert.convertTo(\r\n          this.state.format,\r\n          this.state.messageDescriptor,\r\n          message),\r\n        null\r\n      ],\r\n      messageBuildTimer: null,\r\n    });\r\n  }\r\n\r\n  handleAddToMessage = (path, valueEntry) => {\r\n    console.log('handleAddToMessage', this.state.message, path.toString(), valueEntry);\r\n    this.setState((state) => ({\r\n      message: state.message.updateIn(\r\n        path,\r\n        (list = List()) => list.push(valueEntry)\r\n      ),\r\n      messageBuildTimer: this.scheduleBuildMessage(state.messageBuildTimer),\r\n    }));\r\n  }\r\n\r\n  handleDeleteFromMessage = (path) => {\r\n    // console.log('handleDeleteFromMessage', this.state.message, path.toString());\r\n    this.setState((state) => {\r\n      const listPath = path.pop();\r\n      const listKey = listPath.last();\r\n      const messagePath = listPath.pop()\r\n      const messageWithDeletedListEntry = state.message.deleteIn(path);\r\n      // Delete the whole list if the last entry is removed\r\n      const newMessage = messageWithDeletedListEntry.updateIn(\r\n        messagePath,\r\n        message => (\r\n          message.get(listKey).isEmpty()\r\n          ? message.delete(listKey)\r\n          : message));\r\n      return {\r\n        message: newMessage,\r\n        messageBuildTimer: this.scheduleBuildMessage(state.messageBuildTimer),\r\n      };\r\n    });\r\n  }\r\n\r\n  handleSetInMessage = (path, valueEntry) => {\r\n    // console.log('handleSetInMessage', this.state.message, path, valueEntry);\r\n    this.setState((state) => ({\r\n      message: state.message.setIn(path, valueEntry),\r\n      messageBuildTimer: this.scheduleBuildMessage(state.messageBuildTimer),\r\n    }));\r\n  }\r\n\r\n  handleMoveInMessage = (path, fromIndex, toIndex) => {\r\n    this.setState((state) => ({\r\n      message: state.message.updateIn(\r\n        path,\r\n        (list = List()) => {\r\n          const movedEntry = list.get(fromIndex);\r\n          return list.delete(fromIndex).insert(toIndex, movedEntry);\r\n        }\r\n      ),\r\n      messageBuildTimer: this.scheduleBuildMessage(state.messageBuildTimer),\r\n    }));\r\n  }\r\n\r\n  handleStoreMessage = (path, fullMessageDescriptorName, name) => {\r\n    this.setState((state) => {\r\n      const message = state.message.getIn(path);\r\n      return {\r\n        rawStoredMessages: state.rawStoredMessages.updateIn(\r\n          [fullMessageDescriptorName],\r\n          (map = Map()) => map.set(name, message))\r\n      };\r\n    })\r\n  }\r\n\r\n  handleRemoveStoredMessage = (fullMessageDescriptorName, name) => {\r\n    this.setState((state) => {\r\n      var rawStoredMessages = state.rawStoredMessages.deleteIn(\r\n        [fullMessageDescriptorName, name]);\r\n      rawStoredMessages = rawStoredMessages.get(fullMessageDescriptorName).isEmpty()\r\n        ? rawStoredMessages.delete(fullMessageDescriptorName)\r\n        : rawStoredMessages;\r\n      console.log('handleRemoveStoredMessage', fullMessageDescriptorName, name, rawStoredMessages)\r\n      return {rawStoredMessages};\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    const rawStoredProtos = LocalStorage.protos.load();\r\n    const {protoRoot, fileDependencies} = loadStoredProtos(rawStoredProtos);\r\n    const rawStoredMessages = LocalStorage.messages.load();\r\n    const format = LocalStorage.format.load();\r\n    const config = LocalStorage.config.load();\r\n\r\n    this.setState({\r\n      config,\r\n      rawStoredProtos,\r\n      protoRoot,\r\n      fileDependencies,\r\n      rawStoredMessages,\r\n      format,\r\n    });\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevState.rawStoredProtos !== this.state.rawStoredProtos) {\r\n      LocalStorage.protos.save(this.state.rawStoredProtos);\r\n    }\r\n    if (prevState.format !== this.state.format) {\r\n      LocalStorage.format.save(this.state.format);\r\n    }\r\n    if (prevState.rawStoredMessages !== this.state.rawStoredMessages) {\r\n      LocalStorage.messages.save(this.state.rawStoredMessages);\r\n    }\r\n    if (prevState.config !== this.state.config) {\r\n      LocalStorage.config.save(this.state.config);\r\n    }\r\n  }\r\n\r\n  scheduleBuildMessage = (prevTimeout) => {\r\n    clearTimeout(prevTimeout);\r\n    return setTimeout(() =>\r\n      this.setState((state) => {\r\n        try {\r\n          return {\r\n            builtMessage: [\r\n              ProtoConvert.convertTo(\r\n                state.format,\r\n                state.messageDescriptor,\r\n                state.message),\r\n                null\r\n            ],\r\n            messageBuildTimer: null,\r\n          };\r\n        } catch (err) {\r\n          return {\r\n            builtMessage: [null, err],\r\n            messageBuildTimer: null,\r\n          }\r\n        }\r\n      }),\r\n      500\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={`protool ${this.isNightModeEnabled() ? \"night-mode\" : \"\"}`}>\r\n        <div className=\"proto-library\">\r\n          <ProtoLibrary\r\n            filenames={this.state.rawStoredProtos.keySeq().toList()}\r\n            fileDependencies={this.state.fileDependencies}\r\n            protoRoot={this.state.protoRoot}\r\n            storedMessages={this.state.rawStoredMessages}\r\n            callbacks={this.libraryCallbacks} />\r\n            <div class=\"config\">\r\n              <div class=\"dark-mode-config\">\r\n                Dark mode:\r\n                <input type=\"checkbox\" checked={this.isNightModeEnabled()} onChange={this.handleToggleNightMode} />\r\n              </div>\r\n            </div>\r\n        </div>\r\n        <main>\r\n          <MessageBuilderScaffold\r\n            key={ProtoConvert.fullMessageDescriptorName(this.state.messageDescriptor)}\r\n            messageDescriptor={this.state.messageDescriptor}\r\n            message={this.state.message}\r\n            format={this.state.format}\r\n            builtMessage={this.state.builtMessage}\r\n            buildMessageUpToDate={this.state.messageBuildTimer === null}\r\n            storedMessages={this.state.rawStoredMessages}\r\n            callbacks={this.messageBuilderCallbacks} />\r\n        </main>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Main;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Main from './view/Main';\r\nimport './index.css';\r\n\r\nReactDOM.render(\r\n  <Main />,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}